<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Code Vault</title>
    <style>
        /* BASE THEME */
        :root { 
            --bg: #0f172a; 
            --card: #1e293b; 
            --text: #e2e8f0; 
            --primary: #6366f1; 
            --accent: #10b981; 
            --warn: #f59e0b; 
            --border: #334155;
        }
        
        body { 
            font-family: 'Consolas', 'Monaco', monospace; 
            background: var(--bg); 
            color: var(--text); 
            display: flex; 
            justify-content: center; 
            padding: 20px; 
            min-height: 100vh;
            margin: 0;
            box-sizing: border-box;
        }

        .container { 
            width: 100%; 
            max-width: 600px; 
            background: var(--card); 
            border-radius: 12px; 
            border: 1px solid var(--border); 
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            overflow: hidden; 
            height: fit-content;
        }
        
        /* TABS */
        .tabs { display: flex; background: #020617; border-bottom: 1px solid var(--border); }
        .tab-btn { 
            flex: 1; padding: 15px; background: none; border: none; 
            color: #64748b; cursor: pointer; font-weight: bold; 
            font-family: inherit; transition: 0.3s; 
        }
        .tab-btn:hover { color: var(--text); background: rgba(255,255,255,0.05); }
        .tab-btn.active { 
            color: var(--primary); 
            border-bottom: 3px solid var(--primary); 
            background: rgba(99, 102, 241, 0.1); 
        }
        
        .content { padding: 25px; display: none; }
        .content.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* FORMS */
        h3 { margin-top: 0; text-align: center; color: var(--primary); }
        label { display: block; margin: 15px 0 5px; font-size: 0.85rem; color: #94a3b8; }
        
        textarea, input[type="text"], input[type="file"] { 
            width: 100%; background: #020617; border: 1px solid var(--border); 
            color: #fff; padding: 12px; border-radius: 6px; box-sizing: border-box; 
            font-family: monospace; font-size: 0.9rem;
        }
        textarea { height: 150px; resize: vertical; }
        textarea:focus, input:focus { outline: 1px solid var(--primary); border-color: var(--primary); }
        
        /* BUTTONS */
        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        button.action-btn { 
            flex: 1; padding: 12px; border-radius: 6px; border: none; 
            font-weight: bold; cursor: pointer; transition: 0.2s; 
        }
        .enc-btn { background: var(--primary); color: white; }
        .enc-btn:hover { background: #4f46e5; }
        .dec-btn { background: var(--accent); color: #020617; }
        .dec-btn:hover { background: #059669; }

        /* RESULT AREA */
        .result-box { 
            margin-top: 25px; background: #000; padding: 15px; 
            border-radius: 8px; border: 1px dashed var(--border); display: none; 
        }
        
        .key-box { 
            margin-bottom: 15px; padding: 10px; background: rgba(244, 63, 94, 0.1); 
            border: 1px solid #be123c; border-radius: 4px; text-align: center;
        }
        .key-label { color: #f43f5e; font-size: 0.75rem; font-weight: bold; letter-spacing: 1px; display: block; margin-bottom: 5px; }
        .key-value { color: #f43f5e; font-weight: bold; word-break: break-all; user-select: all; }

        .qr-area { text-align: center; margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border); }
        .qr-img { border: 4px solid white; border-radius: 4px; max-width: 150px; }
        .qr-warn { color: var(--warn); font-size: 0.8rem; border: 1px solid var(--warn); padding: 5px; border-radius: 4px; display: inline-block;}
    </style>
</head>
<body>

<div class="container">
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('text')">üìú CODE / TEXT</button>
        <button class="tab-btn" onclick="switchTab('file')">üìÅ FILE UPLOAD</button>
    </div>

    <div id="tab-text" class="content active">
        <h3>Code Encryptor</h3>
        <label>Input Code (Python/JS/HTML/Text):</label>
        <textarea id="txtInput" placeholder="Paste your source code here..."></textarea>
        
        <label>Key (Only for Decrypt):</label>
        <input type="text" id="txtKey" placeholder="Leave empty to Encrypt">

        <div class="btn-group">
            <button onclick="processText('encrypt')" class="action-btn enc-btn">LOCK üîí</button>
            <button onclick="processText('decrypt')" class="action-btn dec-btn">UNLOCK üîì</button>
        </div>

        <div id="txtResult" class="result-box">
            <div id="txtKeyDisplay" class="key-box" style="display:none;">
                <span class="key-label">‚ö†Ô∏è SECRET KEY (SAVE IT)</span>
                <span id="txtKeyVal" class="key-value"></span>
            </div>
            
            <label>Result:</label>
            <textarea id="txtOutput" readonly></textarea>

            <div id="qrContainer" class="qr-area" style="display:none;">
                <img id="qrImg" class="qr-img">
                <div id="qrMsg" class="qr-warn" style="display:none;">‚ö†Ô∏è Text too long for QR Code</div>
            </div>
        </div>
    </div>

    <div id="tab-file" class="content">
        <h3>File Vault</h3>
        <label>Upload File:</label>
        <input type="file" id="fileInput">
        
        <label>Key (Only for Decrypt):</label>
        <input type="text" id="fileKey" placeholder="Paste key to decrypt">

        <div class="btn-group">
            <button onclick="processFile('encrypt')" class="action-btn enc-btn">ENCRYPT FILE</button>
            <button onclick="processFile('decrypt')" class="action-btn dec-btn">DECRYPT FILE</button>
        </div>

        <div id="fileResult" class="result-box" style="text-align: center;">
            </div>
    </div>
</div>

<script>
    // --- UI LOGIC ---
    function switchTab(tabName) {
        document.querySelectorAll('.content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById('tab-' + tabName).classList.add('active');
        event.target.classList.add('active');
    }

    // --- TEXT LOGIC ---
    async function processText(action) {
        const text = document.getElementById('txtInput').value;
        const key = document.getElementById('txtKey').value;
        const resultBox = document.getElementById('txtResult');
        
        if(!text) return alert("Input text cannot be empty!");
        
        resultBox.style.display = 'block';
        document.getElementById('txtOutput').value = "Processing...";

        try {
            const res = await fetch(`/api/text/${action}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ text, key })
            });
            const data = await res.json();

            if(data.error) return document.getElementById('txtOutput').value = "Error: " + data.error;

            document.getElementById('txtOutput').value = data.result;

            const keyDisplay = document.getElementById('txtKeyDisplay');
            const qrContainer = document.getElementById('qrContainer');

            if(action === 'encrypt') {
                keyDisplay.style.display = 'block';
                document.getElementById('txtKeyVal').innerText = data.key;
                
                qrContainer.style.display = 'block';
                const qrImg = document.getElementById('qrImg');
                const qrMsg = document.getElementById('qrMsg');

                if(data.qr_status === 'ok') {
                    qrImg.src = data.qr;
                    qrImg.style.display = 'inline-block';
                    qrMsg.style.display = 'none';
                } else {
                    qrImg.style.display = 'none';
                    qrMsg.style.display = 'inline-block';
                }
            } else {
                keyDisplay.style.display = 'none';
                qrContainer.style.display = 'none';
            }
        } catch (e) {
            alert("Connection Error!");
        }
    }

    // --- FILE LOGIC ---
    async function processFile(action) {
        const fileIn = document.getElementById('fileInput');
        const key = document.getElementById('fileKey').value;
        const resBox = document.getElementById('fileResult');

        if(fileIn.files.length === 0) return alert("Please select a file!");

        const formData = new FormData();
        formData.append('file', fileIn.files[0]);
        if(key) formData.append('key', key);

        resBox.style.display = 'block';
        resBox.innerHTML = "<p>‚è≥ Uploading & Processing...</p>";

        try {
            const res = await fetch(`/api/file/${action}`, { method: 'POST', body: formData });
            const data = await res.json();

            if(data.error) {
                resBox.innerHTML = `<p style="color:#ef4444">‚ùå ${data.error}</p>`;
                return;
            }

            // Trigger Download
            const link = document.createElement('a');
            link.href = `data:application/octet-stream;base64,${data.file_data}`;
            link.download = data.filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            let html = `<p style="color:#10b981">‚úÖ Success! <b>${data.filename}</b> downloaded.</p>`;
            if(action === 'encrypt') {
                html += `<div class="key-box"><span class="key-label">SAVE THIS KEY:</span><span class="key-value">${data.key}</span></div>`;
            }
            resBox.innerHTML = html;

        } catch (e) {
            resBox.innerHTML = `<p style="color:red">‚ùå Server Error</p>`;
        }
    }
</script>
</body>
</html>
